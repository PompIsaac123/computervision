<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Real-Time Object Detection Viewer</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        canvas {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <canvas id="detectionCanvas"></canvas>
    <script>
        const canvas = document.getElementById('detectionCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        canvas.width = 2000;  // Width of the input stream
        canvas.height = 1000;  // Height of the input stream

        // WebSocket connection setup
        const ws = new WebSocket('ws://172.26.77.152:8765');

        ws.onopen = function () {
            console.log('WebSocket connection established.');
        };

        ws.onmessage = function (event) {
            const detections = JSON.parse(event.data);
            console.log('Received detections:', detections);
            drawDetections(detections);
        };

        ws.onerror = function (error) {
            console.error('WebSocket error:', error);
        };

        function drawDetections(detections) {
            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Define class names based on the COCO dataset
            const classNames = {
                0: 'person',
                2: 'car',
                24: 'backpack',
                7: 'truck'
                // ... include other classes as needed
            };

            // Draw each detection
            detections.forEach(det => {
                const bbox = det.bbox;
                const classId = det.class;
                const center = det.center;

                const x = bbox[0];
                const y = bbox[1];
                const width = bbox[2] - x;
                const height = bbox[3] - y;

                // Draw the bounding box
                ctx.strokeStyle = '#00FF00';
                ctx.lineWidth = 3;
                ctx.strokeRect(x, y, width, height);

                // Draw the class label
                const className = classNames[classId] || 'Unknown';
                ctx.fillStyle = '#FF0000';
                ctx.font = '16px Arial';
                ctx.fillText(`${className} (${classId})`, x, y - 10);

                // Draw the center of the bounding box
                ctx.fillStyle = '#0000FF'; // Blue color for the center dot
                ctx.beginPath();
                ctx.arc(center[0], center[1], 3, 0, 2 * Math.PI); // Draw a small circle for the center
                ctx.fill();
                    });
            }

    </script>
</body>

</html>